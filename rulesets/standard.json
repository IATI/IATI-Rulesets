{
  "//iati-activity": {
    "unique": {
      "cases": [
        {
          "paths": ["reporting-org/@ref", "iati-identifier"],
          "ruleInfo": {
            "id": "1.1.3",
            "severity": "error",
            "category": "identifiers",
            "message": "The activity identifier must be different to the organisation identifier of the reporting organisation."
          }
        }
      ]
    },
    "startswith": {
      "cases": [
        {
          "prefix": ["reporting-org/@ref", "other-identifier[@type='B1']/@ref"],
          "paths": ["iati-identifier"],
          "ruleInfo": {
            "id": "1.1.1",
            "severity": "warning",
            "category": "identifiers",
            "message": "The activity identifier should begin with the organisation identifier of the reporting organisation (or a previous version included in the other-identifier element)."
          }
        },
        {
          "prefix": ["reporting-org/@ref", "other-identifier[@type='B1']/@ref"],
          "separator": "-",
          "paths": ["iati-identifier"],
          "ruleInfo": {
            "id": "1.1.21",
            "severity": "warning",
            "category": "identifiers",
            "message": "The activity identifier should be your IATI Organisation Identifier followed by a unique string for the activity separated by a hyphen e.g. COH-1234-activity1"
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["iati-identifier"],
          "ruleInfo": {
            "id": "1.3.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The iati-identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["planned-disbursement/provider-org/@ref"],
          "ruleInfo": {
            "id": "1.10.8",
            "severity": "warning",
            "category": "financial",
            "message": "The provider organisation id must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["other-identifier/owner-org/@ref"],
          "ruleInfo": {
            "id": "1.11.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The owner organisation id must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["reporting-org/@ref"],
          "ruleInfo": {
            "id": "1.14.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The reporting organisation id must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["planned-disbursement/receiver-org/@ref"],
          "ruleInfo": {
            "id": "1.15.8",
            "severity": "warning",
            "category": "financial",
            "message": "The receiving organisation id must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["other-identifier[@type='B1']/@ref"],
          "ruleInfo": {
            "id": "1.16.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The previous reporting organisation identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["other-identifier[@type='A3']/@ref"],
          "ruleInfo": {
            "id": "1.6.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The previous activity identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": [
            "planned-disbursement/provider-org/@provider-activity-id",
            "transaction/provider-org/@provider-activity-id"
          ],
          "ruleInfo": {
            "id": "1.4.8",
            "severity": "warning",
            "category": "financial",
            "message": "The provider activity identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": [
            "planned-disbursement/receiver-org/@receiver-activity-id",
            "/transaction/receiver-org/@receiver-activity-id"
          ],
          "ruleInfo": {
            "id": "1.5.8",
            "severity": "warning",
            "category": "financial",
            "message": "The receiver activity identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["related-activity/@ref"],
          "ruleInfo": {
            "id": "1.7.8",
            "severity": "warning",
            "category": "relations",
            "message": "The related activity identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["participating-org/@ref"],
          "ruleInfo": {
            "id": "1.8.8",
            "severity": "warning",
            "category": "participating",
            "message": "The participating organisation identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["participating-org/@activity-id"],
          "ruleInfo": {
            "id": "1.9.8",
            "severity": "warning",
            "category": "participating",
            "message": "The participating organisation activity identifier must start with an approved agency code."
          }
        }
      ]
    },
    "atleast_one": {
      "cases": [
        { "paths": ["activity-date[@type='1' or @type='2']"] },
        {
          "paths": ["sector", "transaction/sector"],
          "ruleInfo": {
            "id": "6.2.2",
            "severity": "error",
            "category": "classifications",
            "message": "Each activity must have a specified sector, either at activity level OR for all transactions."
          }
        }
      ]
    },
    "one_or_all": {
      "cases": [
        {
          "one": "@xml:lang",
          "all": "lang",
          "ruleInfo": {
            "id": "4.1.1",
            "severity": "error",
            "category": "information",
            "message": "The activity should specify a default language OR the language must be specified for each narrative element."
          }
        },
        {
          "one": "sector",
          "all": "sector",
          "ruleInfo": {
            "id": "6.7.2",
            "severity": "error",
            "category": "classifications",
            "message": "If sector is declared at transaction level, a sector must be declared for all transactions."
          }
        },
        {
          "one": "@default-currency",
          "all": "currency",
          "ruleInfo": {
            "id": "7.8.1",
            "severity": "error",
            "category": "financial",
            "message": "The activity should specify a default currency OR the currency must be specified for each monetary value."
          }
        }
      ]
    },
    "only_one_of": {
      "cases": [
        {
          "excluded": ["recipient-region", "recipient-country"],
          "paths": [
            "transaction/recipient-country",
            "transaction/recipient-region"
          ]
        }
      ]
    },
    "date_now": {
      "cases": [
        {
          "date": "@last-updated-datetime",
          "ruleInfo": {
            "id": "11.1.1",
            "severity": "error",
            "category": "information",
            "message": "The last updated datetime of the activity must not be in the future."
          }
        }
      ]
    },
    "date_order": {
      "cases": [
        {
          "less": "activity-date[@type='1']/@iso-date",
          "more": "activity-date[@type='3']/@iso-date"
        },
        {
          "less": "activity-date[@type='2']/@iso-date",
          "more": "activity-date[@type='4']/@iso-date"
        },
        {
          "less": "activity-date[@type='2']/@iso-date",
          "more": "NOW"
        },
        {
          "less": "activity-date[@type='4']/@iso-date",
          "more": "NOW"
        },
        {
          "less": "transaction/transaction-date/@iso-date",
          "more": "NOW"
        },
        {
          "less": "transaction/value/@value-date",
          "more": "NOW"
        }
      ]
    },
    "regex_matches": {
      "cases": [
        {
          "regex": "[^\\/\\&\\|\\?]+",
          "paths": [
            "reporting-org/@ref",
            "iati-identifier",
            "participating-org/@ref",
            "transaction/provider-org/@ref",
            "transaction/receiver-org/@ref"
          ]
        }
      ]
    },
    "loop": {
      "cases": [
        {
          "foreach": "sector[@vocabulary != '1']/@vocabulary",
          "do": {
            "strict_sum": {
              "cases": [
                {
                  "paths": ["sector[@vocabulary = '$1']/@percentage"],
                  "sum": 100,
                  "ruleInfo": {
                    "id": "2.1.2",
                    "severity": "error",
                    "category": "classifications",
                    "message": "Percentage values for sectors, within a vocabulary (e.g. 1 - OECD DAC), must add up to 100%."
                  }
                }
              ]
            }
          },
          "subs": ["paths"]
        },
        {
          "foreach": "recipient-region/@vocabulary",
          "do": {
            "strict_sum": {
              "cases": [
                {
                  "paths": [
                    "recipient-region[@vocabulary = '$1']/@percentage",
                    "recipient-country/@percentage"
                  ],
                  "sum": 100,
                  "ruleInfo": {
                    "id": "3.4.2",
                    "severity": "error",
                    "category": "geo",
                    "message": "Percentage values for recipient countries or regions, must add up to 100%."
                  }
                }
              ]
            }
          },
          "subs": ["paths"]
        }
      ]
    },
    "strict_sum": {
      "cases": [
        {
          "paths": [
            "sector[@vocabulary = '1' or not(@vocabulary)]/@percentage"
          ],
          "sum": 100,
          "ruleInfo": {
            "id": "2.1.2",
            "severity": "error",
            "category": "classifications",
            "message": "Percentage values for sectors, within a vocabulary (e.g. 1 - OECD DAC), must add up to 100%."
          }
        },
        {
          "condition": "recipient-country and not(recipient-region)",
          "paths": ["recipient-country/@percentage"],
          "sum": 100,
          "ruleInfo": {
            "id": "3.1.2",
            "severity": "error",
            "category": "geo",
            "message": "Percentage values for recipient countries, must add up to 100%."
          }
        }
      ]
    },
    "range": {
      "cases": [
        {
          "paths": ["recipient-country/@percentage"],
          "min": 0.0,
          "max": 100.0,
          "ruleInfo": {
            "id": "12.1.1",
            "severity": "error",
            "category": "geo",
            "message": "The country/region percentage value must be between 0.0 and 100.0 (inclusive)."
          }
        },
        {
          "paths": ["recipient-region/@percentage"],
          "min": 0.0,
          "max": 100.0,
          "ruleInfo": {
            "id": "12.1.1",
            "severity": "error",
            "category": "geo",
            "message": "The country/region percentage value must be between 0.0 and 100.0 (inclusive)."
          }
        },
        {
          "paths": ["sector/@percentage"],
          "min": 0.0,
          "max": 100.0,
          "ruleInfo": {
            "id": "12.3.1",
            "severity": "error",
            "category": "classifications",
            "message": "The sector percentage value must be between 0.0 and 100.0 (inclusive)."
          }
        },
        {
          "paths": ["capital-spend/@percentage"],
          "min": 0.0,
          "max": 100.0,
          "ruleInfo": {
            "id": "12.2.1",
            "severity": "error",
            "category": "financial",
            "message": "The percentage value must be between 0.0 and 100.0 (inclusive)."
          }
        },
        {
          "paths": ["country-budget-items/budget-item/@percentage"],
          "min": 0.0,
          "max": 100.0,
          "ruleInfo": {
            "id": "12.2.1",
            "severity": "error",
            "category": "financial",
            "message": "The percentage value must be between 0.0 and 100.0 (inclusive)."
          }
        }
      ]
    },
    "if_then": {
      "cases": [
        {
          "if": "count(sector[@vocabulary=98 or @vocabulary=99]) > 0",
          "then": "count(sector[@vocabulary=98 or @vocabulary=99]/narrative) >= count(sector[@vocabulary=98 or @vocabulary=99])",
          "ruleInfo": {
            "id": "2.2.1",
            "severity": "error",
            "category": "classifications",
            "message": "When using a reporting organisation sector code (vocabulary 98 or 99), it must include a narrative."
          }
        },
        {
          "if": "count(sector[not(@vocabulary='')]) + count(sector[not(@vocabulary='1')]) > 0",
          "then": "count(sector[@vocabulary='']) + count(sector[@vocabulary='1']) + count(sector[not(@vocabulary)]) > 0",
          "ruleInfo": {
            "id": "102.1.1",
            "severity": "warning",
            "category": "information",
            "message": "When a non OECD DAC sector vocabulary is used, sector vocabulary 1 - OECD DAC should also be used."
          }
        },
        {
          "if": "count(default-aid-type[not(@vocabulary='')]) + count(default-aid-type[not(@vocabulary='1')]) > 0",
          "then": "count(default-aid-type[@vocabulary='']) + count(default-aid-type[@vocabulary='1']) + count(default-aid-type[not(@vocabulary)]) > 0",
          "ruleInfo": {
            "id": "107.1.1",
            "severity": "warning",
            "category": "information",
            "message": "The activity should also declare an aid type code from aid type vocabulary 1 - OECD DAC."
          }
        },
        {
          "if": "count(sector) > 0",
          "then": "count(transaction/sector) < 1",
          "ruleInfo": {
            "id": "6.6.2",
            "severity": "error",
            "category": "classifications",
            "message": "Sectors must only be declared at activity level OR for all transactions."
          }
        }
      ]
    }
  },
  "//iati-activity/other-identifier/owner-org": {
    "atleast_one": {
      "cases": [
        {
          "paths": ["@ref", "narrative"],
          "ruleInfo": {
            "id": "6.8.1",
            "severity": "error",
            "category": "information",
            "message": "The owner organisation must have an identifier or a narrative."
          }
        }
      ]
    }
  },
  "//iati-activity/transaction/provider-org": {
    "atleast_one": {
      "cases": [{ "paths": ["@ref", "narrative"] }]
    }
  },
  "//iati-activity/transaction/receiver-org": {
    "atleast_one": {
      "cases": [{ "paths": ["@ref", "narrative"] }]
    }
  },
  "//policy-marker": {
    "atleast_one": {
      "cases": [
        {
          "condition": "@vocabulary='1' or not(@vocabulary)",
          "paths": ["@significance"],
          "ruleInfo": {
            "id": "6.14.1",
            "severity": "error",
            "category": "classifications",
            "message": "When using a policy marker code for vocabulary 1, it must include a significance."
          }
        },
        {
          "condition": "@vocabulary='99'",
          "paths": ["narrative"],
          "ruleInfo": {
            "id": "6.13.1",
            "severity": "error",
            "category": "classifications",
            "message": "When using a reporting organisation policy marker code (vocabulary 99), it must include a narrative."
          }
        }
      ]
    }
  },
  "//iati-organisation": {
    "startswith": {
      "cases": [
        {
          "prefix": "ORG-ID",
          "paths": ["organisation-identifier"],
          "ruleInfo": {
            "id": "1.12.8",
            "severity": "warning",
            "category": "organisation",
            "message": "The organisation-identifier must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["recipient-org-budget/recipient-org/@ref"],
          "ruleInfo": {
            "id": "1.17.8",
            "severity": "warning",
            "category": "organisation",
            "message": "The recipient organisation id must start with an approved agency code."
          }
        },
        {
          "prefix": "ORG-ID",
          "paths": ["reporting-org/@ref"],
          "ruleInfo": {
            "id": "1.18.8",
            "severity": "warning",
            "category": "identifiers",
            "message": "The reporting organisation id must start with an approved agency code."
          }
        }
      ]
    },
    "regex_matches": {
      "cases": [
        {
          "regex": "[^\\/\\&\\|\\?]+",
          "paths": ["organisation-identifier"]
        },
        {
          "regex": "[^\\/\\&\\|\\?]+",
          "paths": ["reporting-org/@ref"],
          "ruleInfo": {
            "id": "1.18.13",
            "severity": "warning",
            "category": "information",
            "message": "The {{matchedPathValue}} must not contain any of the symbols /, &, | or ?."
          }
        }
      ]
    },
    "date_now": {
      "cases": [{ "date": "@last-updated-datetime" }]
    },
    "one_or_all": {
      "cases": [
        {
          "one": "@xml:lang",
          "all": "lang",
          "ruleInfo": {
            "id": "4.5.1",
            "severity": "error",
            "category": "information",
            "message": "The organisation should specify a default language, or the language should be specified for each narrative element."
          }
        },
        { "one": "@default-currency", "all": "currency" }
      ]
    }
  },
  "//participating-org": {
    "atleast_one": {
      "cases": [{ "paths": ["@ref", "narrative"] }]
    }
  },
  "//planned-disbursement": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//budget": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//budget/value": {
    "atleast_one": {
      "cases": [
        {
          "paths": ["@value-date"],
          "ruleInfo": {
            "id": "7.5.2",
            "severity": "error",
            "category": "financial",
            "message": "Budget Value must include a Value Date."
          }
        }
      ]
    }
  },
  "//total-budget": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//recipient-country-budget": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "between_dates": {
      "cases": [
        {
          "date": "budget-line/value/@value-date",
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date"
        }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//recipient-org-budget": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//recipient-region-budget": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    },
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    }
  },
  "//result/indicator": {
    "no_more_than_one": {
      "cases": [{ "paths": ["reference[1]", "../reference[1]"] }]
    }
  },
  "//result/indicator/period": {
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    }
  },
  "//total-expenditure": {
    "time_limit": {
      "cases": [
        {
          "start": "period-start/@iso-date",
          "end": "period-end/@iso-date",
          "ruleInfo": {
            "id": "7.5.3",
            "severity": "error",
            "category": "financial",
            "message": "Budget Period must not be longer than one year."
          }
        }
      ]
    },
    "date_order": {
      "cases": [
        { "less": "period-start/@iso-date", "more": "period-end/@iso-date" }
      ]
    }
  },
  "//result/indicator[@measure='1' or @measure='2' or @measure='3' or @measure='4']/baseline": {
    "atleast_one": {
      "cases": [{ "paths": ["@value"] }]
    }
  },
  "//result/indicator[@measure='1' or @measure='2' or @measure='3' or @measure='4']/period/target": {
    "atleast_one": {
      "cases": [{ "paths": ["@value"] }]
    }
  },
  "//result/indicator[@measure='1' or @measure='2' or @measure='3' or @measure='4']/period/actual": {
    "atleast_one": {
      "cases": [{ "paths": ["@value"] }]
    }
  }
}
